
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="AsyncIO MongoDB ODM (Object Document Mapper) using python type hinting" name="description"/>
<link href="../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-6.1.0" name="generator"/>
<title>Usage with FastAPI - ODMantic</title>
<link href="../assets/stylesheets/main.bc7e593a.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.ab28b872.min.css" rel="stylesheet"/>
<meta content="#8bc34b" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../css/extra.css" rel="stylesheet"/>
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-180814888-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
</head>
<body data-md-color-accent="light-green" data-md-color-primary="light-green" data-md-color-scheme="preference" dir="ltr">
<script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#usage-with-fastapi">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="ODMantic" class="md-header-nav__button md-logo" href=".." title="ODMantic">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 9.63c-.19-2.79-1.32-5.51-3.44-7.63A12.253 12.253 0 008.5 9.63c1.29.68 2.47 1.56 3.5 2.63a14.22 14.22 0 013.5-2.63M12 15.45C9.85 12.17 6.18 10 2 10c0 10 9.32 11.89 10 12 .68-.12 10-2 10-12-4.18 0-7.85 2.17-10 5.45z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            ODMantic
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Usage with FastAPI
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/art049/odmantic/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    art049/odmantic
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="ODMantic" class="md-nav__button md-logo" href=".." title="ODMantic">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 9.63c-.19-2.79-1.32-5.51-3.44-7.63A12.253 12.253 0 008.5 9.63c1.29.68 2.47 1.56 3.5 2.63a14.22 14.22 0 013.5-2.63M12 15.45C9.85 12.17 6.18 10 2 10c0 10 9.32 11.89 10 12 .68-.12 10-2 10-12-4.18 0-7.85 2.17-10 5.45z"></path></svg>
</a>
    ODMantic
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/art049/odmantic/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    art049/odmantic
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
      Overview
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../fields/">
      Fields
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../modeling/">
      Modeling
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../engine/">
      Engine
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../filtering/">
      Filtering
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../raw_query_usage/">
      Raw query usage
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Usage with FastAPI
        <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
      Usage with FastAPI
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
    Example
  </a>
<nav aria-label="Example" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#using-the-engine-as-a-dependency">
    Using the engine as a dependency
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creating-a-tree">
    Creating a tree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-all-the-trees">
    Getting all the trees
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#counting-the-trees">
    Counting the trees
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-a-tree-by-id">
    Getting a tree by id
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extending-the-example">
    Extending the example
  </a>
<nav aria-label="Extending the example" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#deleting-a-tree">
    Deleting a tree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updating-a-tree">
    Updating a tree
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upcoming-features">
    Upcoming features
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../usage_pydantic/">
      Usage with Pydantic
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" id="nav-9" type="checkbox"/>
<label class="md-nav__link" for="nav-9">
      API Reference
      <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-9">
<span class="md-nav__icon md-icon"></span>
        API Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/model/">
      odmantic.model
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/engine/">
      odmantic.engine
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/query/">
      odmantic.query
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/field/">
      odmantic.field
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/reference/">
      odmantic.reference
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/bson/">
      odmantic.bson
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/fastapi/">
      odmantic.fastapi
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api_reference/exceptions/">
      odmantic.exceptions
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing/">
      Contributing
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../changelog/">
      Changelog
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
    Example
  </a>
<nav aria-label="Example" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#using-the-engine-as-a-dependency">
    Using the engine as a dependency
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creating-a-tree">
    Creating a tree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-all-the-trees">
    Getting all the trees
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#counting-the-trees">
    Counting the trees
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-a-tree-by-id">
    Getting a tree by id
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#extending-the-example">
    Extending the example
  </a>
<nav aria-label="Extending the example" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#deleting-a-tree">
    Deleting a tree
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#updating-a-tree">
    Updating a tree
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upcoming-features">
    Upcoming features
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/art049/odmantic/edit/master/docs/usage_fastapi.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="usage-with-fastapi">Usage with FastAPI<a class="headerlink" href="#usage-with-fastapi" title="Permanent link">¶</a></h1>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">¶</a></h2>
<p>In this example, we create a minimalist REST API describing trees by their name, average size and discovery year.</p>
<div class="admonition info">
<p class="admonition-title">Requirements</p>
<p>To run the following example, you'll need to install FastAPI and Uvicorn.
<div class="highlight"><pre><span></span><code>pip install fastapi uvicorn
</code></pre></div></p>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">uvicorn</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>

<span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ObjectId</span>
<span class="kn">from</span> <span class="nn">odmantic.fastapi</span> <span class="kn">import</span> <span class="n">AIOEngineDependency</span>


<span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">average_size</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">discovery_year</span><span class="p">:</span> <span class="nb">int</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="n">EngineD</span> <span class="o">=</span> <span class="n">AIOEngineDependency</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">"/trees/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">Tree</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_trees</span><span class="p">(</span><span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">trees</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trees</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/count"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">count_trees</span><span class="p">(</span><span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_tree_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>This script can be run directly:</p>
<div class="highlight"><pre><span></span><code><span class="n">python3</span> <span class="n">script</span><span class="o">.</span><span class="n">py</span>
</code></pre></div>
<p>Uvicorn should start serving the API locally:</p>
<div class="highlight"><pre><span></span><code>INFO:     Started server process [21429]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://localhost:8080 (Press CTRL+C to quit)
</code></pre></div>
<p>To try it out, you can simply access the interactive documentation generated by FastAPI
at <a href="http://localhost:8080/docs" target="blank_">http://localhost:8080/docs</a>.</p>
<p><img align="left" alt="Swagger for the created Tree API" src="../img/usage_fastapi_swagger.png"/></p>
<p>We'll now dive in the details of this example.</p>
<h3 id="using-the-engine-as-a-dependency">Using the engine as a dependency<a class="headerlink" href="#using-the-engine-as-a-dependency" title="Permanent link">¶</a></h3>
<p>After having defined the model, we create the
<a href="../api_reference/fastapi/#odmantic.fastapi.AIOEngineDependency">AIOEngineDependency</a>:</p>
<div class="highlight"><pre><span></span><code><span class="n">EngineD</span> <span class="o">=</span> <span class="n">AIOEngineDependency</span><span class="p">()</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Custom AIOEngine parameters</p>
<p>It's possible as well to build the dependency with custom parameters (mongo URI,
database name).</p>
<p>See <a href="../api_reference/fastapi/#odmantic.fastapi.AIOEngineDependency">this section</a> of the API Reference for
 more details.</p>
</div>
<p>This <a href="https://fastapi.tiangolo.com/tutorial/dependencies/" target="blank_">FastAPI
dependency</a>, will
be used to pass the engine to the routes:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/example"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="c1"># engine is an AIOEngine instance</span>
    <span class="c1"># you can use it to find, save or delete instances</span>
    <span class="o">...</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Type annotation for the Engine dependency</p>
<p>Even if it's not required to annotate the <code>engine</code> argument with its <code>AIOEngine</code>
type, this will strongly help by enabling your IDE to autocomplete the methods and
by making static type analysis possible with the <code>engine</code> object.</p>
</div>
<h3 id="creating-a-tree">Creating a tree<a class="headerlink" href="#creating-a-tree" title="Permanent link">¶</a></h3>
<p>The next step is to define a route enabling us to create a new tree. To that end, we
create a <code>PUT</code> route with the path <code>/trees/</code>. This endpoint will receive a tree,
persist it to the database and return the created object.</p>
<p><div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">"/trees/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>
</code></pre></div>
First, the request body will be parsed to a <code>Tree</code> object (this is done by
specifying the argument <code>tree: Tree</code>). This mean that the model validation will be
performed. Once the model is parsed to a Tree instance, we persist it to the
database and we return it.</p>
<details class="tip" open="open"><summary>Command line tool for interacting with JSON based HTTP APIs</summary><p>To interact with the API from the command line, we recommend to use the
<a href="https://httpie.org/" target="blank_">HTTPie</a> CLI.</p>
<p>The next examples are still provided with the <code>curl</code> syntax since the Swagger
 documentation generated by FastAPI will give you curl examples directly.</p>
</details>
<div class="admonition example">
<p class="admonition-title">Creating a Tree from the command line</p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><label for="__tabbed_1_1">HTTPie</label><div class="tabbed-content">
<p>Send the request:
<div class="highlight"><pre><span></span><code>http PUT localhost:8080/trees/ <span class="nv">name</span><span class="o">=</span><span class="s2">"Spruce"</span> <span class="nv">discovery_year</span><span class="o">=</span><span class="m">1995</span> <span class="nv">average_size</span><span class="o">=</span><span class="m">2</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
content-length: 90
content-type: application/json
date: Sun, 18 Oct 2020 18:40:30 GMT
server: uvicorn

{
    "average_size": 2.0,
    "discovery_year": 1995,
<span class="hll">    "id": "5f8c8c1ff1d33aa1012f3086",
</span>    "name": "Spruce"
}
</code></pre></div></p>
</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio"><label for="__tabbed_1_2">curl</label><div class="tabbed-content">
<p>Send the request:
<div class="highlight"><pre><span></span><code>curl -X PUT <span class="s2">"http://localhost:8080/trees/"</span> <span class="se">\</span>
     -H  <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -d <span class="s1">'{"name":"Spruce", "discovery_year":1995, "average_size":2}'</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"name":"Spruce","average_size":2.0,"discovery_year":1995,"id":"5f8c8c1ff1d33aa1012f3086"}
</code></pre></div></p>
</div>
</input></input></div>
<p>You can notice that the <code>id</code> field has been added automatically by ODMantic.
This <code>id</code> field is actually not required since it's defined automatically by ODMantic
with a default factory method (<a href="../fields/#the-id-field">more details</a>).</p>
<p>You can still specify this field in the request body to predefine the <code>id</code> of the
created instance or to overwrite an existing instance.</p>
</div>
<div class="admonition question">
<p class="admonition-title">Why <code>PUT</code> instead of <code>POST</code> ?</p>
<p>Since the <code>engine.save</code> behave as an upsert operation (<a href="../engine/#update">more
details</a>), you can overwrite instances stored in the database
 by creating a new instance with the same id and calling the <code>engine.save</code> method.</p>
<details class="example"><summary>Modifying the Tree from the command line</summary><p>To overwrite the tree with <code>id=5f8c8c1ff1d33aa1012f3086</code>:</p>
<div class="tabbed-set" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><label for="__tabbed_2_1">HTTPie</label><div class="tabbed-content">
<p>Send the request:
<div class="highlight"><pre><span></span><code>http PUT localhost:8080/trees/ <span class="se">\</span>
    <span class="nv">name</span><span class="o">=</span><span class="s2">"Norway Spruce"</span> <span class="nv">discovery_year</span><span class="o">=</span><span class="m">1795</span> <span class="se">\</span>
    <span class="nv">average_size</span><span class="o">=</span><span class="m">200</span> <span class="nv">id</span><span class="o">=</span><span class="s2">"5f8c8c1ff1d33aa1012f3086"</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
content-length: 90
content-type: application/json
date: Sun, 18 Oct 2020 18:40:30 GMT
server: uvicorn

{
    "average_size": 200.0,
    "discovery_year": 1795,
    "id": "5f8c8c1ff1d33aa1012f3086",
<span class="hll">    "name": "Norway Spruce"
</span>}
</code></pre></div></p>
</div>
<input id="__tabbed_2_2" name="__tabbed_2" type="radio"><label for="__tabbed_2_2">curl</label><div class="tabbed-content">
<p>Send the request:
<div class="highlight"><pre><span></span><code>curl -X PUT <span class="s2">"http://localhost:8080/trees/"</span> <span class="se">\</span>
     -H  <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -d <span class="s1">'{"name":"Norway Spruce", "discovery_year":1795,</span>
<span class="s1">          "average_size":200, "id":"5f8c8c1ff1d33aa1012f3086"}'</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"name":"Norway Spruce","average_size":200.0,"discovery_year":1795,"id":"5f8c8c1ff1d33aa1012f3086"}
</code></pre></div></p>
</div>
</input></input></div>
</details>
<p>Since we can modify an existing instance, it makes more sense to define the
 operation as a <code>PUT</code> instead of a <code>POST</code> that should create a new resource on each
 call.</p>
</div>
<p>If the request body doesn't match our model schema, a <code>422
Unprocessable Entity</code> error will be returned by the API, containing the details about
the error.</p>
<div class="admonition example">
<p class="admonition-title">Invalid data while creating the Tree from the command line</p>
<p>You can try by omitting the <code>average_size</code> field:</p>
<div class="tabbed-set" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"><label for="__tabbed_3_1">HTTPie</label><div class="tabbed-content">
<p>Send the request:
<div class="highlight"><pre><span></span><code>http PUT localhost:8080/trees/ <span class="nv">name</span><span class="o">=</span><span class="s2">"Spruce"</span> <span class="nv">discovery_year</span><span class="o">=</span><span class="m">1995</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="hll">HTTP/1.1 422 Unprocessable Entity
</span>content-length: 96
content-type: application/json
date: Sun, 18 Oct 2020 16:42:18 GMT
server: uvicorn

{
    "detail": [
        {
            "loc": [
                "body",
<span class="hll">                "average_size"
</span>            ],
<span class="hll">            "msg": "field required",
</span>            "type": "value_error.missing"
        }
    ]
}
</code></pre></div></p>
</div>
<input id="__tabbed_3_2" name="__tabbed_3" type="radio"/><label for="__tabbed_3_2">curl</label><div class="tabbed-content">
<p>Send the request:
<div class="highlight"><pre><span></span><code>curl -v -X PUT <span class="s2">"http://localhost:8080/trees/"</span> <span class="se">\</span>
     -H  <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -d <span class="s1">'{"name":"Spruce", "discovery_year":1995}'</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; PUT /trees/ HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/7.58.0
&gt; Accept: */*
&gt; Content-Type: application/json
&gt; Content-Length: 40
&gt;
* upload completely sent off: 40 out of 40 bytes
<span class="hll">&lt; HTTP/1.1 422 Unprocessable Entity
</span>&lt; date: Sun, 18 Oct 2020 18:51:33 GMT
&lt; server: uvicorn
&lt; content-length: 96
&lt; content-type: application/json
&lt;
* Connection #0 to host localhost left intact
<span class="hll">{"detail":[{"loc":["body","average_size"],"msg":"field required","type":"value_error.missing"}]}%
</span></code></pre></div></p>
</div>
</input></div>
<p>The validation error structure is the one that is defined by the <a href="https://pydantic-docs.helpmanual.io/usage/models/#error-handling" target="blank_">Pydantic:
 ValidationError</a>
 exception.</p>
</div>
<p>Finally, specifying the <code>response_model</code> in the <code>app.put</code> decorator is not
mandatory but it is strongly advised as it helps FastAPI to generate the documentation.</p>
<h3 id="getting-all-the-trees">Getting all the trees<a class="headerlink" href="#getting-all-the-trees" title="Permanent link">¶</a></h3>
<p>To get the trees stored in the database, we use the
<a href="../api_reference/engine/#odmantic.engine.AIOEngine.find">AIOEngine.find</a> method in its <code>awaitable</code> form (<a href="../engine/#fetch-multiple-instances">more
details</a>), this gives us directly the list of Tree
instances that we can return directly:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">Tree</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_trees</span><span class="p">(</span><span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">trees</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trees</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Creating and getting the trees from the command line</p>
<div class="tabbed-set" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"/><label for="__tabbed_4_1">HTTPie</label><div class="tabbed-content">
<p>Create some trees:
<div class="highlight"><pre><span></span><code>http PUT localhost:8080/trees/ <span class="nv">name</span><span class="o">=</span><span class="s2">"Spruce"</span> <span class="nv">discovery_year</span><span class="o">=</span><span class="m">1995</span> <span class="nv">average_size</span><span class="o">=</span><span class="m">10</span>.2
http PUT localhost:8080/trees/ <span class="nv">name</span><span class="o">=</span><span class="s2">"Pine"</span> <span class="nv">discovery_year</span><span class="o">=</span><span class="m">1850</span> <span class="nv">average_size</span><span class="o">=</span><span class="m">5</span>
</code></pre></div></p>
<p>Get the trees:
<div class="highlight"><pre><span></span><code>http localhost:8080/trees/
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
content-length: 270
content-type: application/json
date: Sun, 18 Oct 2020 17:59:10 GMT
server: uvicorn

[
    {
        "average_size": 10.2,
        "discovery_year": 1995,
        "id": "5f8c8266f1d33aa1012f3082",
        "name": "Spruce"
    },
    {
        "average_size": 5.0,
        "discovery_year": 1850,
        "id": "5f8c8266f1d33aa1012f3083",
        "name": "Pine"
    }
]
</code></pre></div></p>
</div>
<input id="__tabbed_4_2" name="__tabbed_4" type="radio"/><label for="__tabbed_4_2">curl</label><div class="tabbed-content">
<p>Create some trees:
<div class="highlight"><pre><span></span><code>curl -v -X PUT <span class="s2">"http://localhost:8080/trees/"</span> <span class="se">\</span>
     -H  <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -d <span class="s1">'{"name":"Spruce", "discovery_year":1995, "average_size":10.2}'</span>
curl -v  -X PUT <span class="s2">"http://localhost:8080/trees/"</span> <span class="se">\</span>
     -H  <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -d <span class="s1">'{"name":"Pine", "discovery_year":1850, "average_size":5}'</span>
</code></pre></div>
Get the trees:
<div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/ <span class="p">|</span> python -mjson.tool
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>[
    {
        "name": "Spruce",
        "average_size": 10.2,
        "discovery_year": 1995,
        "id": "5f8c8266f1d33aa1012f3082"
    },
    {
        "name": "Pine",
        "average_size": 5.0,
        "discovery_year": 1850,
        "id": "5f8c8266f1d33aa1012f3083"
    }
]
</code></pre></div></p>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Pagination</p>
<p>You can add pagination to this <code>GET</code> request by using the <code>skip</code> and <code>limit</code>
arguments while calling the <a href="../api_reference/engine/#odmantic.engine.AIOEngine.find">AIOEngine.find</a> method.</p>
</div>
<h3 id="counting-the-trees">Counting the trees<a class="headerlink" href="#counting-the-trees" title="Permanent link">¶</a></h3>
<p>To get the number of trees stored in the database, we use the
<a href="../api_reference/engine/#odmantic.engine.AIOEngine.count">AIOEngine.count</a> method without specifying any query
parameters (to directly get the total count of instances).</p>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/count"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">count_trees</span><span class="p">(</span><span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Getting the tree count from the command line</p>
<div class="tabbed-set" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"/><label for="__tabbed_5_1">HTTPie</label><div class="tabbed-content">
<p>Get the count:
<div class="highlight"><pre><span></span><code>http localhost:8080/trees/count
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
content-length: 1
content-type: application/json
date: Sun, 18 Oct 2020 20:16:50 GMT
server: uvicorn

<span class="hll">2
</span></code></pre></div></p>
</div>
<input id="__tabbed_5_2" name="__tabbed_5" type="radio"/><label for="__tabbed_5_2">curl</label><div class="tabbed-content">
<p>Get the count:
<div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/count
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>2
</code></pre></div></p>
</div>
</div>
</div>
<h3 id="getting-a-tree-by-id">Getting a tree by <code>id</code><a class="headerlink" href="#getting-a-tree-by-id" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_tree_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>
</code></pre></div>
<p>To return a tree from its <code>id</code> we add a path parameter <code>id: ObjectId</code>. Once this
endpoint is called, FastAPI will try to validate this query parameter, thus inferring an
<code>ObjectId</code> object.</p>
<div class="admonition warning">
<p class="admonition-title">Using BSON objects as parameters</p>
<p>While you can define ODMantic models directly using <code>bson</code> fields (<a href="../fields/#bson-types-integration">more
details</a>), it's not possible to use those types
directly with FastAPI, you'll need to get the equivalent objects from the
<a href="../api_reference/bson/">odmantic.bson</a> module. Those equivalent types implement the
additional validation logic enabling FastAPI to work with them.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">odmantic.bson</span> <span class="kn">import</span> <span class="n">ObjectId</span>
</code></pre></div>
<p>For convenience reasons, the <code>ObjectId</code> type including the validation logic is as
well available directly from the <code>odmantic</code> module.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">ObjectId</span>
</code></pre></div>
</div>
<p>With this <code>ObjectId</code>, we build a query that will filter only the instances having this
exactly same <code>id</code>:
<div class="highlight"><pre><span></span><code><span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span>
</code></pre></div>
Then, we pass this query to the <a href="../api_reference/engine/#odmantic.engine.AIOEngine.find_one">AIOEngine.find_one</a> method that will try to return an instance, otherwise <code>None</code> will be returned:
<div class="highlight"><pre><span></span><code><span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
</code></pre></div>
Now, if our tree object is None (i.e the instance has not been found), we need to return
a <code>404 Not Found</code> error:
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</code></pre></div>
Otherwise, we found the requested instance. We can return it !
<div class="highlight"><pre><span></span><code><span class="k">return</span> <span class="n">tree</span>
</code></pre></div></p>
<div class="admonition example">
<p class="admonition-title">Getting a tree from the command line</p>
<div class="tabbed-set" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio"/><label for="__tabbed_6_1">HTTPie</label><div class="tabbed-content">
<p>Get the tree <code>5f8c8266f1d33aa1012f3082</code>:
<div class="highlight"><pre><span></span><code>http localhost:8080/trees/5f8c8266f1d33aa1012f3082
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
content-length: 91
content-type: application/json
date: Sun, 18 Oct 2020 21:08:07 GMT
server: uvicorn

{
    "average_size": 10.2,
    "discovery_year": 1995,
<span class="hll">    "id": "5f8c8266f1d33aa1012f3082",
</span>    "name": "Spruce"
}
</code></pre></div></p>
</div>
<input id="__tabbed_6_2" name="__tabbed_6" type="radio"/><label for="__tabbed_6_2">curl</label><div class="tabbed-content">
<p>Get the tree <code>5f8c8266f1d33aa1012f3082</code>:</p>
<p><div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/5f8c8266f1d33aa1012f3082
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"name":"Spruce","average_size":10.2,"discovery_year":1995,"id":"5f8c8266f1d33aa1012f3082"}
</code></pre></div></p>
</div>
</div>
</div>
<div class="admonition example">
<p class="admonition-title">Trying to get a tree not in the database from the command line</p>
<div class="tabbed-set" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio"/><label for="__tabbed_7_1">HTTPie</label><div class="tabbed-content">
<p>Try to get the tree <code>f0f0f0f0f0f0f0f0f0f0f0f0</code> (it has not been created):
<div class="highlight"><pre><span></span><code>http localhost:8080/trees/f0f0f0f0f0f0f0f0f0f0f0f0
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="hll">HTTP/1.1 404 Not Found
</span>content-length: 22
content-type: application/json
date: Sun, 18 Oct 2020 21:11:48 GMT
server: uvicorn

{
<span class="hll">    "detail": "Not Found"
</span>}
</code></pre></div></p>
</div>
<input id="__tabbed_7_2" name="__tabbed_7" type="radio"/><label for="__tabbed_7_2">curl</label><div class="tabbed-content">
<p>Try to get the tree <code>f0f0f0f0f0f0f0f0f0f0f0f0</code> (it has not been created):
<div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/f0f0f0f0f0f0f0f0f0f0f0f0
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"detail":"Not Found"}
</code></pre></div></p>
</div>
</div>
</div>
<p>This <code>id</code> path parameter should be a 16 characters hexadecimal string (see <a href="https://docs.mongodb.com/manual/reference/method/ObjectId/" target="blank_">MongoDB:
ObjectId</a>
for more details). If the <code>id</code> specified in the path does not match this criteria, a <code>422
Unprocessable Entity</code> error will be returned:</p>
<div class="admonition example">
<p class="admonition-title">Trying to get a tree with an invalid <code>id</code> from the command line</p>
<div class="tabbed-set" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio"/><label for="__tabbed_8_1">HTTPie</label><div class="tabbed-content">
<p>Get the tree identified by <code>invalid_object_id</code>:
<div class="highlight"><pre><span></span><code>http localhost:8080/trees/invalid_object_id
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="hll">HTTP/1.1 422 Unprocessable Entity
</span>content-length: 89
content-type: application/json
date: Sun, 18 Oct 2020 20:50:25 GMT
server: uvicorn

{
    "detail": [
        {
            "loc": [
<span class="hll">                "path",
</span><span class="hll">                "id"
</span>            ],
<span class="hll">            "msg": "invalid ObjectId specified",
</span>            "type": "type_error"
        }
    ]
}
</code></pre></div></p>
</div>
<input id="__tabbed_8_2" name="__tabbed_8" type="radio"/><label for="__tabbed_8_2">curl</label><div class="tabbed-content">
<p>Get the tree identified by <code>invalid_object_id</code>:</p>
<p><div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/invalid_object_id
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"detail":[{"loc":["path","id"],"msg":"invalid ObjectId specified","type":"type_error"}]}
</code></pre></div></p>
</div>
</div>
</div>
<h2 id="extending-the-example">Extending the example<a class="headerlink" href="#extending-the-example" title="Permanent link">¶</a></h2>
<h3 id="deleting-a-tree">Deleting a tree<a class="headerlink" href="#deleting-a-tree" title="Permanent link">¶</a></h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">uvicorn</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>

<span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ObjectId</span>
<span class="kn">from</span> <span class="nn">odmantic.fastapi</span> <span class="kn">import</span> <span class="n">AIOEngineDependency</span>


<span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">average_size</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">discovery_year</span><span class="p">:</span> <span class="nb">int</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="n">EngineD</span> <span class="o">=</span> <span class="n">AIOEngineDependency</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_tree_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>


<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"/trees/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
</span><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">delete_tree_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
</span><span class="hll">    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span class="hll">        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class="hll">    <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">tree</span>
</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>This new <code>DELETE</code> route is strongly inspired from the one used to <a href="#getting-a-tree-by-id">get a tree from its
<code>id</code></a>.</p>
<p>Currently, ODMantic can only delete an instance and it's not possible to perform a
delete operation from a query filter. Thus, we first need to get the associated
instance. Once we have the instance, we call the
<a href="../api_reference/engine/#odmantic.engine.AIOEngine.delete">AIOEngine.delete</a> method to perform the deletion.</p>
<div class="admonition example">
<p class="admonition-title">Deleting a tree from the command line</p>
<div class="tabbed-set" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio"/><label for="__tabbed_9_1">HTTPie</label><div class="tabbed-content">
<p>Delete the tree identified by <code>5f8c8266f1d33aa1012f3082</code>:
<div class="highlight"><pre><span></span><code>http DELETE localhost:8080/trees/5f8c8266f1d33aa1012f3082
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="hll">HTTP/1.1 200 OK
</span>content-length: 91
content-type: application/json
date: Sun, 18 Oct 2020 21:35:22 GMT
server: uvicorn

{
    "average_size": 10.2,
    "discovery_year": 1995,
    "id": "5f8c8266f1d33aa1012f3082",
    "name": "Spruce"
}
</code></pre></div></p>
<p>Check that the tree is not stored anymore:</p>
<p><div class="highlight"><pre><span></span><code>http localhost:8080/trees/5f8c8266f1d33aa1012f3082
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="hll">HTTP/1.1 404 Not Found
</span>content-length: 22
content-type: application/json
date: Sun, 18 Oct 2020 21:36:45 GMT
server: uvicorn

{
<span class="hll">    "detail": "Not Found"
</span>}
</code></pre></div></p>
</div>
<input id="__tabbed_9_2" name="__tabbed_9" type="radio"/><label for="__tabbed_9_2">curl</label><div class="tabbed-content">
<p>Delete the tree identified by <code>5f8c8266f1d33aa1012f3082</code>:
<div class="highlight"><pre><span></span><code>curl -X DELETE http://localhost:8080/trees/5f8c8266f1d33aa1012f3082
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"name":"Spruce","average_size":10.2,"discovery_year":1995,"id":"5f8c8266f1d33aa1012f3082"}
</code></pre></div>
Check that the tree is not stored anymore:
<div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/5f8c8266f1d33aa1012f3082
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"detail":"Not Found"}
</code></pre></div></p>
</div>
</div>
<p>The tree has been removed successfully !</p>
</div>
<h3 id="updating-a-tree">Updating a tree<a class="headerlink" href="#updating-a-tree" title="Permanent link">¶</a></h3>
<p>We already defined a <code>PUT</code> route that enables us to modify (replace) a tree instance.
However, with this previopus implementation, it's not possible to specify only the
fields that we want to change as the whole Tree instance is rebuilt from the request's
body.</p>
<p>In this example, we will define a <code>PATCH</code> method that will allow us to modify some
fields of a Tree instance:</p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">uvicorn</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ObjectId</span>
<span class="kn">from</span> <span class="nn">odmantic.fastapi</span> <span class="kn">import</span> <span class="n">AIOEngineDependency</span>


<span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">average_size</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">discovery_year</span><span class="p">:</span> <span class="nb">int</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="n">EngineD</span> <span class="o">=</span> <span class="n">AIOEngineDependency</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/trees/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_tree_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>


<span class="hll"><span class="k">class</span> <span class="nc">TreePatchSchema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span class="hll">    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span class="hll">    <span class="n">average_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span><span class="hll">    <span class="n">discovery_year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span>

<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"/trees/</span><span class="si">{id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Tree</span><span class="p">)</span>
</span><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">update_tree_by_id</span><span class="p">(</span>
</span><span class="hll">    <span class="nb">id</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span>
</span><span class="hll">    <span class="n">patch</span><span class="p">:</span> <span class="n">TreePatchSchema</span><span class="p">,</span>
</span><span class="hll">    <span class="n">engine</span><span class="p">:</span> <span class="n">AIOEngine</span> <span class="o">=</span> <span class="n">EngineD</span><span class="p">,</span>
</span><span class="hll"><span class="p">):</span>
</span><span class="hll">    <span class="n">tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Tree</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="nb">id</span><span class="p">)</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span class="hll">        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">patch_dict</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">patch_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class="hll">        <span class="nb">setattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span class="hll">    <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">tree</span>
</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
First, we define the <code>TreePatchSchema</code> this Pydantic model will contain the
modifications that we need to apply on the instance. Since we want to be able to update
each field independently, we make them all non required (i.e. <code>Optional</code>) in the schema.</p>
<p>Then, we configure a new <code>PATCH</code> endpoint by setting the <code>id</code> of the model to update
as a path parameter and the <code>TreePatchSchema</code> as the request body parameter.</p>
<p>Once all the parameters have been validated properly and the associated instance have
been gathered, we can apply the modifications to the model.</p>
<p>The first step is to create a dictionnary containing only the fields to modify (the
<code>exclude_unset</code> argument help us to gather only the field that have been set in the
body):</p>
<div class="highlight"><pre><span></span><code><span class="n">patch_dict</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>The next step is to iterate over this dictionary to apply the changes to the model
iteratively:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">patch_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Using setattr to update an instance</p>
<p>Here we use the <code>setattr</code> builtin function to update the instance attributes.</p>
<p>For example:
<div class="highlight"><pre><span></span><code><span class="nb">setattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">"average_size"</span><span class="p">,</span> <span class="mf">21.5</span><span class="p">)</span>
</code></pre></div>
will have exactly the same effect as:
<div class="highlight"><pre><span></span><code><span class="n">tree</span><span class="o">.</span><span class="n">average_size</span> <span class="o">=</span> <span class="mf">21.5</span>
</code></pre></div></p>
</div>
<p>Once our tree has been properly patched, we can save it and return it's updated version.
<div class="highlight"><pre><span></span><code><span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="k">return</span> <span class="n">tree</span>
</code></pre></div></p>
<div class="admonition example">
<p class="admonition-title">Updating a tree from the command line</p>
<div class="tabbed-set" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio"/><label for="__tabbed_10_1">HTTPie</label><div class="tabbed-content">
<p>Update the tree identified by <code>5f8c8266f1d33aa1012f3083</code>:
<div class="highlight"><pre><span></span><code>http PATCH localhost:8080/trees/5f8c8266f1d33aa1012f3083 <span class="se">\</span>
    <span class="nv">discovery_year</span><span class="o">=</span><span class="m">1825</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"Stone Pine"</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="hll">HTTP/1.1 200 OK
</span>content-length: 94
content-type: application/json
date: Sun, 18 Oct 2020 22:02:44 GMT
server: uvicorn

{
    "average_size": 5.0,
    "discovery_year": 1825,
    "id": "5f8c8266f1d33aa1012f3083",
    "name": "Stone Pine"
}
</code></pre></div></p>
<p>Check that the tree has been updated properly:</p>
<p><div class="highlight"><pre><span></span><code>http localhost:8080/trees/5f8c8266f1d33aa1012f3083
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK
content-length: 94
content-type: application/json
date: Sun, 18 Oct 2020 22:06:52 GMT
server: uvicorn

{
    "average_size": 5.0,
<span class="hll">    "discovery_year": 1825,
</span>    "id": "5f8c8266f1d33aa1012f3083",
<span class="hll">    "name": "Stone Pine"
</span>}
</code></pre></div></p>
</div>
<input id="__tabbed_10_2" name="__tabbed_10" type="radio"/><label for="__tabbed_10_2">curl</label><div class="tabbed-content">
<p>Update the tree identified by <code>5f8c8266f1d33aa1012f3083</code>:
<div class="highlight"><pre><span></span><code>curl -X PATCH <span class="s2">"http://localhost:8080/trees/5f8c8266f1d33aa1012f3083"</span> <span class="se">\</span>
     -H  <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
     -d <span class="s1">'{"name":"Stone Pine", "discovery_year":1825}'</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"name":"Stone Pine","average_size":5.0,"discovery_year":1825,"id":"5f8c8266f1d33aa1012f3083"}
</code></pre></div>
Check that the tree has been updated properly:
<div class="highlight"><pre><span></span><code>curl http://localhost:8080/trees/5f8c8266f1d33aa1012f3083
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code>{"name":"Stone Pine","average_size":5.0,"discovery_year":1825,"id":"5f8c8266f1d33aa1012f3083"}
</code></pre></div></p>
</div>
</div>
<p>The tree has been updated successfully !</p>
</div>
<h2 id="upcoming-features">Upcoming features<a class="headerlink" href="#upcoming-features" title="Permanent link">¶</a></h2>
<p>A lot of feature could still improve the ODMantic + FastAPI experience.</p>
<p>Some ideas that should arrive soon:</p>
<ul>
<li>Add a <code>not_found_exception</code> argument to the AIOEngine.find_one method. Thus, if the
  document is not found an exception will be raised directly.</li>
<li>Implement the equivalent of MongoDB insert method to be able to create document
  without overwriting existing ones.</li>
<li>Implement a Model.update method to update the model fields from a dictionnary or from
  a Pydantic schema.</li>
<li>Automatically generate CRUD endpoints directly from an ODMantic Model.</li>
</ul>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../raw_query_usage/" rel="prev">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Raw query usage
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../usage_pydantic/" rel="next">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Usage with Pydantic
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/art049" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://twitter.com/art049" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://www.linkedin.com/in/arthur-pastel-a08579112" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../assets/javascripts/vendor.6a3d08fc.min.js"></script>
<script src="../assets/javascripts/bundle.71201edf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
<script>
        app = initialize({
          base: "..",
          features: ['instant'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
<script src="../js/gitter.js"></script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script>
</body>
</html>