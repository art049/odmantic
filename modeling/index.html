
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AsyncIO MongoDB ODM (Object Document Mapper) using python type hinting">
      
      
      
        <link rel="canonical" href="https://art049.github.io/odmantic/modeling/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>Modeling - ODMantic</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#8bc34b">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-180814888-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="light-green" data-md-color-accent="light-green">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modeling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ODMantic" class="md-header__button md-logo" aria-label="ODMantic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.5 9.63c-.19-2.79-1.32-5.51-3.44-7.63A12.253 12.253 0 0 0 8.5 9.63c1.29.68 2.47 1.56 3.5 2.63a14.22 14.22 0 0 1 3.5-2.63M12 15.45C9.85 12.17 6.18 10 2 10c0 10 9.32 11.89 10 12 .68-.12 10-2 10-12-4.18 0-7.85 2.17-10 5.45Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ODMantic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modeling
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/art049/odmantic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    art049/odmantic
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ODMantic" class="md-nav__button md-logo" aria-label="ODMantic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.5 9.63c-.19-2.79-1.32-5.51-3.44-7.63A12.253 12.253 0 0 0 8.5 9.63c1.29.68 2.47 1.56 3.5 2.63a14.22 14.22 0 0 1 3.5-2.63M12 15.45C9.85 12.17 6.18 10 2 10c0 10 9.32 11.89 10 12 .68-.12 10-2 10-12-4.18 0-7.85 2.17-10 5.45Z"/></svg>

    </a>
    ODMantic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/art049/odmantic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    art049/odmantic
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fields/" class="md-nav__link">
        Fields
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Modeling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Modeling
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    Models
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    Collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-model-validators" class="md-nav__link">
    Custom model validators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-configuration" class="md-nav__link">
    Advanced Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedded-models" class="md-nav__link">
    Embedded Models
  </a>
  
    <nav class="md-nav" aria-label="Embedded Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-to-one" class="md-nav__link">
    One to One
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-to-many" class="md-nav__link">
    One to Many
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    Customization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referenced-models" class="md-nav__link">
    Referenced models
  </a>
  
    <nav class="md-nav" aria-label="Referenced models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#many-to-one-mapped" class="md-nav__link">
    Many to One (Mapped)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many-to-many-manual" class="md-nav__link">
    Many to Many (Manual)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../engine/" class="md-nav__link">
        Engine
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../querying/" class="md-nav__link">
        Querying
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../raw_query_usage/" class="md-nav__link">
        Raw query usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage_fastapi/" class="md-nav__link">
        Usage with FastAPI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage_pydantic/" class="md-nav__link">
        Usage with Pydantic
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/model/" class="md-nav__link">
        odmantic.model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/engine/" class="md-nav__link">
        odmantic.engine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/query/" class="md-nav__link">
        odmantic.query
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/field/" class="md-nav__link">
        odmantic.field
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/reference/" class="md-nav__link">
        odmantic.reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/bson/" class="md-nav__link">
        odmantic.bson
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/fastapi/" class="md-nav__link">
        odmantic.fastapi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reference/exceptions/" class="md-nav__link">
        odmantic.exceptions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    Models
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    Collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-model-validators" class="md-nav__link">
    Custom model validators
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-configuration" class="md-nav__link">
    Advanced Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedded-models" class="md-nav__link">
    Embedded Models
  </a>
  
    <nav class="md-nav" aria-label="Embedded Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-to-one" class="md-nav__link">
    One to One
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-to-many" class="md-nav__link">
    One to Many
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    Customization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referenced-models" class="md-nav__link">
    Referenced models
  </a>
  
    <nav class="md-nav" aria-label="Referenced models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#many-to-one-mapped" class="md-nav__link">
    Many to One (Mapped)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#many-to-many-manual" class="md-nav__link">
    Many to Many (Manual)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/art049/odmantic/edit/master/docs/modeling.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="modeling">Modeling<a class="headerlink" href="#modeling" title="Permanent link">&para;</a></h1>
<h2 id="models">Models<a class="headerlink" href="#models" title="Permanent link">&para;</a></h2>
<p>To create a Model, simply inherit from the <a class="autorefs autorefs-internal" href="../api_reference/model/#odmantic.model.Model">Model</a> class and then
specify the field types and eventually their descriptors.</p>
<h3 id="collection">Collection<a class="headerlink" href="#collection" title="Permanent link">&para;</a></h3>
<p>Each Model will be linked to its own collection. By default, the collection name will be
created from the chosen class name and converted to
<a href="https://en.wikipedia.org/wiki/Snake_case">snake_case</a>. For example a model class named
<code>CapitalCity</code> will be stored in the collection named <code>capital_city</code>.</p>
<p>If the class name ends with <code>Model</code>, ODMantic will remove it to create the collection
name. For example, a model class named <code>PersonModel</code> will belong in the <code>person</code>
collection.</p>
<p>It's possible to customize the collection name of a model by specifying the <code>collection</code>
option in the <code>Config</code> class.</p>
<div class="admonition example">
<p class="admonition-title">Custom collection name example</p>
<p><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="k">class</span> <span class="nc">CapitalCity</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">population</span><span class="p">:</span> <span class="nb">int</span>

<span class="hll">    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span class="hll">        <span class="n">collection</span> <span class="o">=</span> <span class="s2">&quot;city&quot;</span>
</span></code></pre></div>
Now, when <code>CapitalCity</code> instances will be persisted to the database, they will
belong in the <code>city</code> collection instead of <code>capital_city</code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Models and Embedded models inheritance is not supported yet.</p>
</div>
<h3 id="custom-model-validators">Custom model validators<a class="headerlink" href="#custom-model-validators" title="Permanent link">&para;</a></h3>
<p>Exactly as done with pydantic, it's possible to define custom model validators as
described in the <a href="https://pydantic-docs.helpmanual.io/usage/validators/#root-validators" target="blank_">pydantic: Root
Validators</a>
documentation (this apply as well to Embedded Models).</p>
<p>In the following example, we will define a rectangle class and add two validators: The
first one will check that the height is greater than the width. The second one will
ensure that the area of the rectangle is less or equal to 9.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">root_validator</span>

<span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">Model</span>


<span class="k">class</span> <span class="nc">SmallRectangle</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<span class="hll">    <span class="n">MAX_AREA</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>

<span class="hll">    <span class="nd">@root_validator</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">check_width_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span>        <span class="n">length</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="hll">        <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;width can&#39;t be greater than length&quot;</span><span class="p">)</span>
</span>        <span class="k">return</span> <span class="n">values</span>

<span class="hll">    <span class="nd">@root_validator</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">check_area</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span>        <span class="n">length</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="hll">        <span class="k">if</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="bp">cls</span><span class="o">.</span><span class="n">MAX_AREA</span><span class="p">:</span>
</span><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;area is greater than </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">MAX_AREA</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span>        <span class="k">return</span> <span class="n">values</span>


<span class="nb">print</span><span class="p">(</span><span class="n">SmallRectangle</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#&gt; id=ObjectId(&#39;5f81e3c073103f509f97e374&#39;), length=2.0, width=1.0</span>

<span class="k">try</span><span class="p">:</span>
<span class="hll">    <span class="n">SmallRectangle</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for SmallRectangle</span>
<span class="hll"><span class="sd">    width</span>
</span><span class="hll"><span class="sd">      field required (type=value_error.missing)</span>
</span><span class="sd">    &quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
<span class="hll">    <span class="n">SmallRectangle</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for SmallRectangle</span>
<span class="hll"><span class="sd">    __root__</span>
</span><span class="hll"><span class="sd">      width can&#39;t be greater than length (type=value_error)</span>
</span><span class="sd">    &quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
<span class="hll">    <span class="n">SmallRectangle</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for SmallRectangle</span>
<span class="hll"><span class="sd">    __root__</span>
</span><span class="hll"><span class="sd">      area is greater than 9 (type=value_error)</span>
</span><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can define class variables in the Models using the <code>typing.ClassVar</code> type
construct, as done in this example with <code>MAX_AREA</code>. Those class variables will be
completely ignored by ODMantic while persisting instances to the database.</p>
</div>
<h3 id="advanced-configuration">Advanced Configuration<a class="headerlink" href="#advanced-configuration" title="Permanent link">&para;</a></h3>
<p>The model configuration is done in the same way as with Pydantic models: using a <a href="https://pydantic-docs.helpmanual.io/usage/model_config/" target="blank_">Config
class</a> defined
in the model body.</p>
<p><strong>Available options</strong>:</p>
<dl>
<dt><code class="highlight"><span class="n">collection</span><span class="p">:</span> <span class="nb">str</span></code></dt>
<dd>Customize the collection name associated to the model. see <a href="./#collection">this
  section</a> for more details about default collection naming.</dd>
<dt><code class="highlight"><span class="n">parse_doc_with_default_factories</span><span class="p">:</span> <span class="nb">bool</span></code></dt>
<dd>
<p>Wether to allow populating field values with default factories while parsing
  documents from the database. See <a href="../raw_query_usage/#advanced-parsing-behavior">this
  section</a> for more details.</p>
<p>Default: <code class="highlight"><span class="kc">False</span></code></p>
</dd>
<dt><code class="highlight"><span class="n">title</span><span class="p">:</span> <span class="nb">str</span></code> <em>(inherited from Pydantic)</em></dt>
<dd>
<p>Title inferred in the JSON schema.</p>
<p>Default: name of the model class</p>
</dd>
<dt><code class="highlight"><span class="n">schema_extra</span><span class="p">:</span> <span class="nb">dict</span></code> <em>(inherited from Pydantic)</em></dt>
<dd>
<p>A dict used to extend/update the generated JSON Schema, or a callable to
  post-process it. See <a href="https://pydantic-docs.helpmanual.io/usage/schema/#schema-customization" target="_blank">Pydantic: Schema customization</a> for more details.</p>
<p>Default: <code class="highlight"><span class="p">{}</span></code></p>
</dd>
<dt><code class="highlight"><span class="n">anystr_strip_whitespace</span><span class="p">:</span> <span class="nb">bool</span></code> <em>(inherited from Pydantic)</em></dt>
<dd>
<p>Whether to strip leading and trailing whitespaces for str &amp; byte types.</p>
<p>Default: <code class="highlight"><span class="kc">False</span></code></p>
</dd>
<dt><code class="highlight"><span class="n">json_encoders</span><span class="p">:</span> <span class="nb">dict</span></code> <em>(inherited from Pydantic)</em></dt>
<dd>
<p>Customize the way types used in the model are encoded to JSON.</p>
<details class="example">
<summary><code>json_encoders</code> example</summary>
<p>For example, in order to serialize <code>datetime</code> fields as timestamp values:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">json_encoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">datetime</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div>
</details>
</dd>
<dt><code class="highlight"><span class="n">json_loads</span></code> <em>(inherited from Pydantic)</em></dt>
<dd>
<p>Function used to decode JSON data</p>
<p>Default: <code class="highlight"><span class="n">json</span><span class="o">.</span><span class="n">loads</span></code></p>
</dd>
<dt><code class="highlight"><span class="n">json_dumps</span></code> <em>(inherited from Pydantic)</em></dt>
<dd>
<p>Function used to encode JSON data</p>
<p>Default: <code class="highlight"><span class="n">json</span><span class="o">.</span><span class="n">dumps</span></code></p>
</dd>
</dl>
<p>For more details and examples about the options inherited from Pydantic, you can have a
look to <a href="https://pydantic-docs.helpmanual.io/usage/model_config/" target="blank_">Pydantic: Model
Config</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only the options described above are supported and other options from Pydantic can't
be used with ODMantic.</p>
<p>If you feel the need to have an additional option inherited from Pydantic, you can
<a href="https://github.com/art049/odmantic/issues/new" target="blank">open an issue</a>.</p>
</div>
<h2 id="embedded-models">Embedded Models<a class="headerlink" href="#embedded-models" title="Permanent link">&para;</a></h2>
<p>Using an embedded model will store it directly in the root model it's integrated
in. On the MongoDB side, the collection will contain the root documents and in inside
each of them, the embedded models will be directly stored.</p>
<p>Embedded models are especially useful while building
<a href="https://en.wikipedia.org/wiki/One-to-one_(data_model)" target="_blank">one-to-one</a> or
<a href="https://en.wikipedia.org/wiki/One-to-many_(data_model)" target="_blank">one-to-many</a>
relationships.</p>
<!-- prettier-ignore -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since Embedded Models are directly embedded in the MongoDB collection of the root
model, it will not be possible to query on them directly without specifying a root
document.</p>
</div>
<p>The creation of an Embedded model is done by inheriting the
<a class="autorefs autorefs-internal" href="../api_reference/model/#odmantic.model.EmbeddedModel">EmbeddedModel</a> class. You can then define fields exactly
as for the regular Models.</p>
<h3 id="one-to-one">One to One<a class="headerlink" href="#one-to-one" title="Permanent link">&para;</a></h3>
<p>In this example, we will model the relation between a country and its capital city.
Since one capital city can belong to one and only one country, we can model this
relation as a One-to-One relationship. We will use an Embedded Model in this case.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">EmbeddedModel</span><span class="p">,</span> <span class="n">Model</span>


<span class="hll"><span class="k">class</span> <span class="nc">CapitalCity</span><span class="p">(</span><span class="n">EmbeddedModel</span><span class="p">):</span>
</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">population</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">currency</span><span class="p">:</span> <span class="nb">str</span>
<span class="hll">    <span class="n">capital_city</span><span class="p">:</span> <span class="n">CapitalCity</span>
</span>

<span class="n">countries</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Country</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Switzerland&quot;</span><span class="p">,</span>
        <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;Swiss franc&quot;</span><span class="p">,</span>
<span class="hll">        <span class="n">capital_city</span><span class="o">=</span><span class="n">CapitalCity</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bern&quot;</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="mi">1035000</span><span class="p">),</span>
</span>    <span class="p">),</span>
    <span class="n">Country</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sweden&quot;</span><span class="p">,</span>
        <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;Swedish krona&quot;</span><span class="p">,</span>
<span class="hll">        <span class="n">capital_city</span><span class="o">=</span><span class="n">CapitalCity</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Stockholm&quot;</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="mi">975904</span><span class="p">),</span>
</span>    <span class="p">),</span>
<span class="p">]</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">AIOEngine</span><span class="p">()</span>
<span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save_all</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Defining this relation is done in the same way as defining a new field. Here, the
<code>CapitalCity</code> class will be considered as a field type during the model definition.</p>
<p>The <a class="autorefs autorefs-internal" href="../api_reference/field/#odmantic.field.Field">Field</a> descriptor can be used as well for Embedded
Models in order to bring more flexibility (default values, Mongo key name, ...).</p>
<details class="abstract" open="open">
<summary>Content of the <code>country</code> collection after execution</summary>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f79d7e8b305f24ca43593e2&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sweden&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;currency&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Swedish krona&quot;</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;capital_city&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Stockholm&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="nt">&quot;population&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">975904</span><span class="w"></span>
</span><span class="hll"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f79d7e8b305f24ca43593e1&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Switzerland&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;currency&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Swiss franc&quot;</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;capital_city&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bern&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="nt">&quot;population&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1035000</span><span class="w"></span>
</span><span class="hll"><span class="w">  </span><span class="p">}</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<!-- prettier-ignore -->
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is possible as well to define query filters based on embedded documents content.</p>
<div class="highlight"><pre><span></span><code><span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span>
<span class="hll">    <span class="n">Country</span><span class="p">,</span> <span class="n">Country</span><span class="o">.</span><span class="n">capital_city</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Stockholm&quot;</span>
</span><span class="p">)</span>
<span class="c1">#&gt; Country(</span>
<span class="c1">#&gt;     id=ObjectId(&quot;5f79d7e8b305f24ca43593e2&quot;),</span>
<span class="c1">#&gt;     name=&quot;Sweden&quot;,</span>
<span class="c1">#&gt;     currency=&quot;Swedish krona&quot;,</span>
<span class="c1">#&gt;     capital_city=CapitalCity(name=&quot;Stockholm&quot;, population=975904),</span>
<span class="c1">#&gt; )</span>
</code></pre></div>
<p>For more details, see the <a href="../querying/">Querying</a> section.</p>
</div>
<h3 id="one-to-many">One to Many<a class="headerlink" href="#one-to-many" title="Permanent link">&para;</a></h3>
<p>Here, we will model the relation between a customer of an online shop and his shipping
addresses. A single customer can have multiple addresses but these addresses belong only
to the customer's account. He should be allowed to modify them without modifying others
addresses (for example if two family members use the same address, their addresses
should not be linked together).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">EmbeddedModel</span><span class="p">,</span> <span class="n">Model</span>


<span class="hll"><span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">EmbeddedModel</span><span class="p">):</span>
</span>    <span class="n">street</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">city</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">zipcode</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Customer</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
<span class="hll">    <span class="n">addresses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Address</span><span class="p">]</span>
</span>

<span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">addresses</span><span class="o">=</span><span class="p">[</span>
</span><span class="hll">        <span class="n">Address</span><span class="p">(</span>
</span><span class="hll">            <span class="n">street</span><span class="o">=</span><span class="s2">&quot;1757  Birch Street&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Greenwood&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;Indiana&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="n">zipcode</span><span class="o">=</span><span class="s2">&quot;46142&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="p">),</span>
</span><span class="hll">        <span class="n">Address</span><span class="p">(</span>
</span><span class="hll">            <span class="n">street</span><span class="o">=</span><span class="s2">&quot;262  Barnes Avenue&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="n">city</span><span class="o">=</span><span class="s2">&quot;Cincinnati&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="n">state</span><span class="o">=</span><span class="s2">&quot;Ohio&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="n">zipcode</span><span class="o">=</span><span class="s2">&quot;45216&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="p">),</span>
</span><span class="hll">    <span class="p">],</span>
</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">AIOEngine</span><span class="p">()</span>
<span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>As done previously for the One to One relation, defining a One to Many relationship with
Embedded Models is done exactly as defining a field with its type being a sequence of
<code>Address</code> objects.</p>
<details class="abstract" open="open">
<summary>Content of the <code>customer</code> collection after execution</summary>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f79eb116371e09b16e4fae4&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;addresses&quot;</span><span class="p">:[</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;street&quot;</span><span class="p">:</span><span class="s2">&quot;1757  Birch Street&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="s2">&quot;Greenwood&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="s2">&quot;Indiana&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;zipcode&quot;</span><span class="p">:</span><span class="s2">&quot;46142&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="p">},</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="p">{</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;street&quot;</span><span class="p">:</span><span class="s2">&quot;262  Barnes Avenue&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;city&quot;</span><span class="p">:</span><span class="s2">&quot;Cincinnati&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="s2">&quot;Ohio&quot;</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">      </span><span class="nt">&quot;zipcode&quot;</span><span class="p">:</span><span class="s2">&quot;45216&quot;</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="p">}</span><span class="w"></span>
</span><span class="hll"><span class="w">  </span><span class="p">]</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<!-- prettier-ignore -->
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To add conditions on the number of embedded elements, it's possible to use the
<code>min_items</code> and <code>max_items</code> arguments of the <a class="autorefs autorefs-internal" href="../api_reference/field/#odmantic.field.Field">Field</a>
descriptor. Another possibility is to use the <code>typing.Tuple</code> type.</p>
</div>
<!-- prettier-ignore -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Building query filters based on the content of a sequence of embedded documents is
not supported yet (but this feature is planned for an upcoming release <img alt="" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/72x72/1f525.png" title=":fire:" />).</p>
<p>Anyway, it's still possible to perform the filtering operation manually using Mongo
<a href="https://docs.mongodb.com/manual/reference/operator/query-array/" target="_blank">Array Operators</a>
(<code>$all</code>, <code>$elemMatch</code>, <code>$size</code>). See the <a href="../raw_query_usage/">Raw query usage</a> section for
more details.</p>
</div>
<h3 id="customization">Customization<a class="headerlink" href="#customization" title="Permanent link">&para;</a></h3>
<p>Since the Embedded Models are considered as types by ODMantic, most of the complex type
constructs that could be imagined should be supported.</p>
<p>Some ideas which could be useful:</p>
<ul>
<li>
<p>Combine two different embedded models in a single field using <code>typing.Tuple</code>.</p>
</li>
<li>
<p>Allow multiple Embedded model types using a <code>typing.Union</code> type.</p>
</li>
<li>
<p>Make an Embedded model not required using <code>typing.Optional</code>.</p>
</li>
<li>
<p>Embed the documents in a dictionary (using the <code>typing.Dict</code> type) to provide an
  additional key-value mapping to the embedded documents.</p>
</li>
<li>
<p>Nest embedded documents</p>
</li>
</ul>
<h2 id="referenced-models">Referenced models<a class="headerlink" href="#referenced-models" title="Permanent link">&para;</a></h2>
<p>Embedded models are really simple to use but sometimes it is needed as well to
have <strong>many-to-one</strong> (i.e. multiple entities referring to another single one) or
<a href="https://en.wikipedia.org/wiki/Many-to-many_(data_model)" target="_blank">many-to-many</a>
relationships. This is not really possible to model those using embedded documents and
in this case, references will come handy.
Another use case where references are useful is for one-to-one/one-to-many relations but
when the referenced model has to exist in its own collection, in order to be accessed on
 its own without any parent model specified.</p>
<h3 id="many-to-one-mapped">Many to One (Mapped)<a class="headerlink" href="#many-to-one-mapped" title="Permanent link">&para;</a></h3>
<p>In this part, we will model the relation between books and publishers. Let's consider that each
book has a single publisher. In this case, multiple books could be published by the same
publisher. We can thus model this relation as a many-to-one relationship.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Reference</span>


<span class="hll"><span class="k">class</span> <span class="nc">Publisher</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
</span>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">founded</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>


<span class="hll"><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
</span>    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pages</span><span class="p">:</span> <span class="nb">int</span>
<span class="hll">    <span class="n">publisher</span><span class="p">:</span> <span class="n">Publisher</span> <span class="o">=</span> <span class="n">Reference</span><span class="p">()</span>
</span>

<span class="n">hachette</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Hachette Livre&quot;</span><span class="p">,</span> <span class="n">founded</span><span class="o">=</span><span class="mi">1826</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;FR&quot;</span><span class="p">)</span>
<span class="n">harper</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;HarperCollins&quot;</span><span class="p">,</span> <span class="n">founded</span><span class="o">=</span><span class="mi">1989</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;US&quot;</span><span class="p">)</span>

<span class="hll"><span class="n">books</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">    <span class="n">Book</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;They Didn&#39;t See Us Coming&quot;</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="mi">304</span><span class="p">,</span> <span class="n">publisher</span><span class="o">=</span><span class="n">hachette</span><span class="p">),</span>
</span><span class="hll">    <span class="n">Book</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;This Isn&#39;t Happening&quot;</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">publisher</span><span class="o">=</span><span class="n">hachette</span><span class="p">),</span>
</span><span class="hll">    <span class="n">Book</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Prodigal Summer&quot;</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="mi">464</span><span class="p">,</span> <span class="n">publisher</span><span class="o">=</span><span class="n">harper</span><span class="p">),</span>
</span><span class="hll"><span class="p">]</span>
</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">AIOEngine</span><span class="p">()</span>
<span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save_all</span><span class="p">(</span><span class="n">books</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The definition of a reference field <strong>requires</strong> the presence of the <a class="autorefs autorefs-internal" href="../api_reference/reference/#odmantic.reference.Reference">Reference()</a>
descriptor. Once the models are defined, linking two instances is done simply by
assigning the reference field of referencing instance to the referenced instance.</p>
<details class="question">
<summary>Why is it required to include the Reference descriptor ?</summary>
<p>The main goal behind enforcing the presence of the descriptor is to have a clear
distinction between Embedded Models and References.</p>
<p>In the future, a generic <code>Reference[T]</code> type will probably be included to make this
distinction since it would make more sense than having to set a descriptor for each
reference.</p>
</details>
<details class="abstract" open="open">
<summary>Content of the <code>publisher</code> collection after execution</summary>
<p><div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a364&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;founded&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1826</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FR&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hachette Livre&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a365&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;founded&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1989</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;US&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HarperCollins&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
We can see that the publishers have been persisted to their collection even if no
explicit save has been perfomed.
When calling the <a class="autorefs autorefs-internal" href="../api_reference/engine/#odmantic.engine.AIOEngine.save">engine.save</a> method, the engine
will persist automatically the referenced documents.</p>
<p>While fetching instances, the engine will as well resolve <strong>every</strong> reference.</p>
</details>
<details class="abstract" open="open">
<summary>Content of the <code>book</code> collection after execution</summary>
<p><div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a366&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;pages&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">304</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a364&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;They Didn&#39;t See Us Coming&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a367&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;pages&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a364&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This Isn&#39;t Happening&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a368&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;pages&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">464</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a0dc48a73b20f16e2a365&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prodigal Summer&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
The resulting books in the collection contain the publisher reference directly as a
document attribute (using the reference name as the document's key).</p>
</details>
<!-- prettier-ignore -->
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It's possible to customize the foreign key storage key using the <code>key_name</code> argument
while building the <a class="autorefs autorefs-internal" href="../api_reference/reference/#odmantic.reference.Reference">Reference</a> descriptor.</p>
</div>
<h3 id="many-to-many-manual">Many to Many (Manual)<a class="headerlink" href="#many-to-many-manual" title="Permanent link">&para;</a></h3>
<p>Here, we will model the relation between books and their authors. Since a book can have
multiple authors and an author can be authoring multiple books, we will model this
 relation as a many-to-many relationship.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, ODMantic does not support mapped multi-references yet. But we will still
define the relationship in a manual way.</p>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">bson</span> <span class="kn">import</span> <span class="n">ObjectId</span>

<span class="kn">from</span> <span class="nn">odmantic</span> <span class="kn">import</span> <span class="n">AIOEngine</span><span class="p">,</span> <span class="n">Model</span>


<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
<span class="hll">    <span class="n">pages</span><span class="p">:</span> <span class="nb">int</span>
</span>    <span class="n">author_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ObjectId</span><span class="p">]</span>


<span class="hll"><span class="n">david</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;David Beazley&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="n">brian</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Brian K. Jones&quot;</span><span class="p">)</span>
</span>
<span class="n">python_cookbook</span> <span class="o">=</span> <span class="n">Book</span><span class="p">(</span>
<span class="hll">    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Python Cookbook&quot;</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="mi">706</span><span class="p">,</span> <span class="n">author_ids</span><span class="o">=</span><span class="p">[</span><span class="n">david</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">brian</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
</span><span class="p">)</span>
<span class="n">python_essentials</span> <span class="o">=</span> <span class="n">Book</span><span class="p">(</span>
<span class="hll">    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Python Essential Reference&quot;</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="mi">717</span><span class="p">,</span> <span class="n">author_ids</span><span class="o">=</span><span class="p">[</span><span class="n">brian</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">AIOEngine</span><span class="p">()</span>
<span class="hll"><span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save_all</span><span class="p">((</span><span class="n">david</span><span class="p">,</span> <span class="n">brian</span><span class="p">))</span>
</span><span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">save_all</span><span class="p">((</span><span class="n">python_cookbook</span><span class="p">,</span> <span class="n">python_essentials</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<p>We defined an <code>author_ids</code> field which holds the list of unique ids of the authors (This
<code>id</code> field in the <code>Author</code> model is generated implicitly by default).</p>
<p>Since this multi-reference is not mapped by the ODM, we have to persist the authors
manually.</p>
<details class="abstract" open="open">
<summary>Content of the <code>author</code> collection after execution</summary>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da4e&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;David Beazley&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da4f&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brian K. Jones&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<details class="abstract" open="open">
<summary>Content of the <code>book</code> collection after execution</summary>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da50&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="nt">&quot;Python Cookbook&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;pages&quot;</span><span class="p">:</span><span class="mi">706</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;author_ids&quot;</span><span class="p">:[</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da4e&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da4f&quot;</span><span class="err">)</span><span class="w"></span>
</span><span class="hll"><span class="w">  </span><span class="p">],</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da51&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="nt">&quot;Python Essential Reference&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;pages&quot;</span><span class="p">:</span><span class="mi">717</span><span class="p">,</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nt">&quot;author_ids&quot;</span><span class="p">:[</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;5f7a37dc7311be1362e1da4f&quot;</span><span class="err">)</span><span class="w"></span>
</span><span class="hll"><span class="w">  </span><span class="p">],</span><span class="w"></span>
</span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<div class="admonition example">
<p class="admonition-title">Retrieving the authors of the Python Cookbook</p>
<p>First, it's required to fetch the ids of the authors. Then we can use the
<a class="autorefs autorefs-internal" href="../api_reference/query/#odmantic.query.in_">in_</a> filter to select only the authors with the desired ids.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">book</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;Python Cookbook&quot;</span><span class="p">)</span>
<span class="hll"><span class="n">authors</span> <span class="o">=</span> <span class="k">await</span> <span class="n">engine</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Author</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">author_ids</span><span class="p">))</span>
</span><span class="nb">print</span><span class="p">(</span><span class="n">authors</span><span class="p">)</span>
<span class="c1">#&gt; [</span>
<span class="c1">#&gt;   Author(id=ObjectId(&quot;5f7a37dc7311be1362e1da4e&quot;), name=&quot;David Beazley&quot;),</span>
<span class="c1">#&gt;   Author(id=ObjectId(&quot;5f7a37dc7311be1362e1da4f&quot;), name=&quot;Brian K. Jones&quot;),</span>
<span class="c1">#&gt; ]</span>
</code></pre></div></td></tr></table></div>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../fields/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Fields" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Fields
            </div>
          </div>
        </a>
      
      
        
        <a href="../engine/" class="md-footer__link md-footer__link--next" aria-label="Next: Engine" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Engine
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/art049" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/art049" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/in/arthur-pastel-a08579112" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["instant"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
        <script src="../js/gitter.js"></script>
      
        <script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script>
      
    
  </body>
</html>